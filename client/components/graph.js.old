import React from 'react'
import Rickshaw from 'rickshaw'
import PUBNUB from 'pubnub'

class GraphPage extends React.Component {
  createGraph() {
    this.graph = new Rickshaw.Graph({
      element: document.getElementById('chart'),
      width: 900,
      height: 500,
      renderer: 'area',
      stroke: true,
      preserve: true,
      series: [
        {
          color: 'steelblue',
          name: 'Cats',
          data: []
        },
        {
          color: 'lightblue',
          name: 'Dogs',
          data: []
        }
      ]
    })
  }

  createFixture() {
    Rickshaw.Fixtures.PubNub
     = {
      channel: 'rickshaw-channel-1',
      graph: this.graph
    }
  }

  initPubNub() {
    console.log('PUBNUB', PUBNUB)
    const pubnub = new PUBNUB({
      publish_key: 'demo',
      subscribe_key: 'demo'
    })
    console.log('pubnub', pubnub)
    setInterval(function(){
      console.log('publishing')
      pubnub.publish({
        channel: 'rickshaw-channel-1',
        message: {
          y: [
            Math.random() * 99,
            Math.random() * 99
          ],
          x: new Date().getTime()
        }
      })
    }, 1000);
  }

  componentDidMount() {
    this.createGraph()
    this.createFixture()
    this.initPubNub()

    console.log('graph.js | cdm | graph', this.graph)
    console.log('graph.js | cdm | Rickshaw.Fixtures', Rickshaw)

    this.graph.render()
  }

  render() {
    console.log('graph.js | render | graph', this.graph)
    return <div id="chart" />
  }
}

export default GraphPage
